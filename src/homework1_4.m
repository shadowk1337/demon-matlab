% Пункт 4, получение аналитического выражения при 
% ступенчатом входном воздействии
% Для этого пункта понадобится пакет Symbolic Math Toolbox
% Скачать пакет: Home->Add-ons->"Get Add-Ons"

findAnalyticalExpression();

function findAnalyticalExpression()
    syms t lambda;

%     K = [                   0.31204*exp(-806.55*t) + exp(t*(331.23 - 653.98i))*(0.34398 + 0.018197i) + exp(t*(331.23 + 653.98i))*(0.34398 - 0.018197i), - exp(-806.55*t)*(0.00038465 + 6.7763e-21i) + exp(t*(331.23 - 653.98i))*(0.00019233 + 0.00042995i) + exp(t*(331.23 + 653.98i))*(0.00019233 - 0.00042995i),                        5.8064e-7*exp(-806.55*t) - exp(t*(331.23 - 653.98i))*(2.9032e-7 - 5.0509e-7i) - exp(t*(331.23 + 653.98i))*(2.9032e-7 + 5.0509e-7i);
%         - exp(-806.55*t)*(251.42 + 1.4211e-14i) + exp(t*(331.23 - 653.98i))*(125.71 - 218.71i) + exp(t*(331.23 + 653.98i))*(125.71 + 218.71i),                                0.31024*exp(-806.55*t) + exp(t*(331.23 - 653.98i))*(0.34488 + 0.016633i) + exp(t*(331.23 + 653.98i))*(0.34488 - 0.016633i), - exp(-806.55*t)*(0.00046826 - 1.1858e-20i) + exp(t*(331.23 - 653.98i))*(0.00023413 + 0.00035721i) + exp(t*(331.23 + 653.98i))*(0.00023413 - 0.00035721i);
% exp(-806.55*t)*(202760.0 + 1.1823e-11i) - exp(t*(331.23 - 653.98i))*(101380.0 + 154670.0i) - exp(t*(331.23 + 653.98i))*(101380.0 - 154670.0i),                     - exp(-806.55*t)*(249.97 - 1.4211e-14i) + exp(t*(331.23 - 653.98i))*(124.98 - 219.81i) + exp(t*(331.23 + 653.98i))*(124.98 + 219.81i),                                0.37767*exp(-806.55*t) + exp(t*(331.23 - 653.98i))*(0.31116 - 0.034805i) + exp(t*(331.23 + 653.98i))*(0.31116 + 0.034805i)]

%     K = [              0.29806*exp(-481.21*t) + exp(t*(172.55 - 372.92i))*(0.35097 + 0.029913i) + exp(t*(172.55 + 372.92i))*(0.35097 - 0.029913i), - exp(-481.21*t)*(0.00060921 + 5.421e-20i) + exp(t*(172.55 - 372.92i))*(0.0003046 + 0.00080677i) + exp(t*(172.55 + 372.92i))*(0.0003046 - 0.00080677i),                        1.7653e-6*exp(-481.21*t) - exp(t*(172.55 - 372.92i))*(8.8266e-7 - 1.5474e-6i) - exp(t*(172.55 + 372.92i))*(8.8266e-7 + 1.5474e-6i);
%    - exp(-481.21*t)*(143.43 - 1.4211e-14i) + exp(t*(172.55 - 372.92i))*(71.716 - 125.72i) + exp(t*(172.55 + 372.92i))*(71.716 + 125.72i),                             0.29316*exp(-481.21*t) + exp(t*(172.55 - 372.92i))*(0.35342 + 0.025614i) + exp(t*(172.55 + 372.92i))*(0.35342 - 0.025614i), - exp(-481.21*t)*(0.00084949 + 7.4539e-20i) + exp(t*(172.55 - 372.92i))*(0.00042474 + 0.00059616i) + exp(t*(172.55 + 372.92i))*(0.00042474 - 0.00059616i);
% exp(-481.21*t)*(69021.0 - 3.1832e-12i) - exp(t*(172.55 - 372.92i))*(34510.0 + 48438.0i) - exp(t*(172.55 + 372.92i))*(34510.0 - 48438.0i),                  - exp(-481.21*t)*(141.07 + 2.1316e-14i) + exp(t*(172.55 - 372.92i))*(70.536 - 127.38i) + exp(t*(172.55 + 372.92i))*(70.536 + 127.38i),                                0.40878*exp(-481.21*t) + exp(t*(172.55 - 372.92i))*(0.29561 - 0.055529i) + exp(t*(172.55 + 372.92i))*(0.29561 + 0.055529i)]

    K = [          0.096976*exp(-126.84*t) + exp(t*(- 4.6373 - 39.748i))*(0.45151 + 0.20741i) + exp(t*(- 4.6373 + 39.748i))*(0.45151 - 0.20741i),           0.00056164*exp(-126.84*t) - exp(t*(- 4.6373 - 39.748i))*(0.00028082 - 0.013443i) - exp(t*(- 4.6373 + 39.748i))*(0.00028082 + 0.013443i),           0.000060557*exp(-126.84*t) - exp(t*(- 4.6373 - 39.748i))*(0.000030278 - 0.000093089i) - exp(t*(- 4.6373 + 39.748i))*(0.000030278 + 0.000093089i);
- exp(-126.84*t)*(12.3 + 8.8818e-16i) + exp(t*(- 4.6373 - 39.748i))*(6.1502 - 18.908i) + exp(t*(- 4.6373 + 39.748i))*(6.1502 + 18.908i), - exp(-126.84*t)*(0.071239 + 1.3878e-17i) + exp(t*(- 4.6373 - 39.748i))*(0.53562 - 0.051176i) + exp(t*(- 4.6373 + 39.748i))*(0.53562 + 0.051176i), - exp(-126.84*t)*(0.0076808 + 3.7947e-19i) + exp(t*(- 4.6373 - 39.748i))*(0.0038404 + 0.00077225i) + exp(t*(- 4.6373 + 39.748i))*(0.0038404 - 0.00077225i);
exp(-126.84*t)*(1560.1 + 2.8422e-14i) - exp(t*(- 4.6373 - 39.748i))*(780.06 + 156.86i) - exp(t*(- 4.6373 + 39.748i))*(780.06 - 156.86i),                           9.0353*exp(-126.84*t) - exp(t*(- 4.6373 - 39.748i))*(4.5176 + 21.053i) - exp(t*(- 4.6373 + 39.748i))*(4.5176 - 21.053i),             exp(-126.84*t)*(0.97419 + 6.9389e-18i) + exp(t*(- 4.6373 - 39.748i))*(0.012906 - 0.15629i) + exp(t*(- 4.6373 + 39.748i))*(0.012906 + 0.15629i)]

%     K = [           0.17617*exp(-165.03*t) + exp(t*(10.514 - 80.347i))*(0.41191 + 0.12702i) + exp(t*(10.514 + 80.347i))*(0.41191 - 0.12702i), - 0.00056419*exp(-165.03*t) + exp(t*(10.514 - 80.347i))*(0.00028209 + 0.0056067i) + exp(t*(10.514 + 80.347i))*(0.00028209 - 0.0056067i),            0.00002683*exp(-165.03*t) - exp(t*(10.514 - 80.347i))*(0.000013415 - 0.00002931i) - exp(t*(10.514 + 80.347i))*(0.000013415 + 0.00002931i);
% - exp(-165.03*t)*(29.073 - 1.7764e-15i) + exp(t*(10.514 - 80.347i))*(14.537 - 31.76i) + exp(t*(10.514 + 80.347i))*(14.537 + 31.76i),             0.093106*exp(-165.03*t) + exp(t*(10.514 - 80.347i))*(0.45345 + 0.036281i) + exp(t*(10.514 + 80.347i))*(0.45345 - 0.036281i), - exp(-165.03*t)*(0.0044277 - 1.6263e-19i) + exp(t*(10.514 - 80.347i))*(0.0022139 + 0.0013861i) + exp(t*(10.514 + 80.347i))*(0.0022139 - 0.0013861i);
%                 4797.9*exp(-165.03*t) - exp(t*(10.514 - 80.347i))*(2399.0 + 1502.0i) - exp(t*(10.514 + 80.347i))*(2399.0 - 1502.0i),   - exp(-165.03*t)*(15.365 + 1.7764e-15i) + exp(t*(10.514 - 80.347i))*(7.6825 - 36.051i) + exp(t*(10.514 + 80.347i))*(7.6825 + 36.051i),                              0.7307*exp(-165.03*t) + exp(t*(10.514 - 80.347i))*(0.13465 - 0.16332i) + exp(t*(10.514 + 80.347i))*(0.13465 + 0.16332i)]

    K = subs(K, t, t - lambda);
    B = [0; 0; 203120];
    integEq = K * B;
    disp(vpa(integEq(1,:), 4));
    disp(vpa(int(integEq(1,:), lambda, 0, t), 4));
    
    MInt = int(integEq, lambda, 0, t) * 13600;

    time = 0:0.005:1;
    y = zeros(size(time));
    zero = zeros(size(time));
    for i = 1:max(size(time))
        y(i) = subs(MInt(1,:), time(i));
    end
    plot(time, y);
    hold on
    plot(time, zero);
end